# 实时模拟功能说明

## ✅ 功能已实现

现在可以**实时查看AI模拟过程**，不需要先模拟后回放！

## 🚀 快速开始（3步）

### 1. 启动服务器

```bash
cd /Users/sunyuefeng/GenerativeAgentsCN-1/generative_agents
python web_server.py
```

### 2. 打开浏览器

```
http://127.0.0.1:5000
```

### 3. 观看

AI角色会自动：
- ✅ 移动到不同位置
- ✅ 执行各种活动
- ✅ 相互对话
- ✅ 展示真实的AI思考结果

## 📺 你会看到什么

### 终端输出

```
=== 实时模拟已启动 ===
模拟名称: web_auto_1699876543
步进间隔: 10 分钟
使用真实AI: 是
Game instance created successfully with 25 agents

--- 执行步骤 1 ---
[步骤 1] 阿伊莎: 阿伊莎正在图书馆学习 at [25, 32]
[步骤 1] 克劳斯: 克劳斯正在咖啡馆喝咖啡 at [45, 28]
[步骤 1] 玛丽亚: 玛丽亚在和阿伊莎聊天 at [26, 33]
✓ 已发送更新到前端，包含 25 个角色

--- 执行步骤 2 ---
[步骤 2] 阿伊莎: 阿伊莎对玛丽亚说：你最近怎么样？ at [25, 33]
...
```

### 浏览器画面

```
┌─────────────────────────────────────────────────┐
│  小镇地图                          [时间: 09:30] │
│                                                 │
│     🏠 房屋        🌳 树木                       │
│                                                 │
│   👤 阿伊莎                   👤 克劳斯          │
│   💬 "正在学习"               💬 "在喝咖啡"      │
│                                                 │
│         👤 玛丽亚                                │
│         💬 "在和阿伊莎聊天"                       │
│                                                 │
│  ☕ 咖啡馆      📚 图书馆       🏢 办公室        │
│                                                 │
└─────────────────────────────────────────────────┘

右侧边栏：
┌──────────────────┐
│ 角色列表         │
├──────────────────┤
│ 👤 阿伊莎        │
│ 状态: 正在学习   │
│                  │
│ 👤 克劳斯        │
│ 状态: 在喝咖啡   │
│                  │
│ 👤 玛丽亚        │
│ 状态: 在聊天     │
└──────────────────┘
```

## 🎮 操作控制

- **方向键 ←↑↓→** - 移动视角
- **鼠标滚轮** - 缩放地图
- **点击角色** - 查看详细信息（如果实现）

## ⚙️ 核心改进

### 之前（回放模式）

```
1. python start.py (运行模拟，保存数据)
   ↓
2. python compress.py (压缩数据)
   ↓
3. python replay.py (启动回放)
   ↓
4. 打开浏览器观看
```

**问题**：必须等模拟完成，无法实时查看

### 现在（实时模式）

```
1. python web_server.py
   ↓
2. 打开浏览器
   ↓
3. 立即看到AI实时活动！
```

**优势**：
- ✅ 立即看到结果
- ✅ 实时观察AI决策
- ✅ 可以随时暂停观察
- ✅ 无需等待完成

## 🔧 调整设置

### 改变速度

编辑 `generative_agents/web_server.py` 第848行：

```python
time.sleep(2)  # 2秒一步

# 调整选项：
# time.sleep(0.5)  # 快速 - 每0.5秒一步
# time.sleep(1)    # 正常 - 每秒一步
# time.sleep(2)    # 推荐 - 每2秒一步（给AI足够时间）
# time.sleep(5)    # 慢速 - 每5秒一步
```

### 改变时间步进

第742行：

```python
stride = data.get('stride', 10)  # 每步代表10分钟

# 选项：
# stride=5   # 每步5分钟
# stride=10  # 每步10分钟（默认）
# stride=30  # 每步30分钟
```

### 配置LLM

编辑 `generative_agents/data/config.json`：

```json
{
  "provider": "ollama",
  "model": "qwen2.5:14b",
  "base_url": "http://localhost:11434"
}
```

## 📋 没有角色？创建一些！

### 方法1：使用测试脚本

```bash
python test_character_generator.py
```

按提示输入角色信息，系统会自动：
- 智能选择合适的角色图片
- 创建角色配置文件
- 保存到正确位置

### 方法2：手动创建

在 `generative_agents/frontend/static/assets/village/agents/` 创建文件夹：

```
agents/
└── 张三/
    ├── agent.json
    └── texture.png
```

`agent.json` 示例：
```json
{
  "name": "张三",
  "age": 30,
  "occupation": "工程师",
  "personality": "友善",
  "coord": [50, 50],
  "currently": "张三正在工作"
}
```

## ❓ 常见问题

### Q1: 角色不移动？

**检查终端输出**：
- 应该看到：`使用真实AI: 是`
- 应该看到：`Game instance created successfully`

**如果看到**：
- `使用真实AI: 否` → 检查角色配置
- `Error creating game instance` → 检查LLM配置

### Q2: 没有对话？

- 等待几分钟，AI需要时间产生对话
- 角色需要接近才会对话
- 增加角色数量提高互动概率

### Q3: 速度太慢？

**优化方法**：
1. 减少角色数量（从3-5个开始）
2. 使用更快的LLM模型（如 qwen2.5:7b）
3. 修改 `time.sleep()` 值
4. 使用GPU加速

### Q4: 如何保存模拟？

当前实时模拟不自动保存。如需保存：
- 使用命令行模式：`python start.py`
- 或等待后续版本添加保存功能

## 📊 性能建议

| 角色数 | 推荐模型 | 速度设置 | 体验 |
|-------|---------|---------|------|
| 3-5 | qwen2.5:7b | 1秒/步 | 流畅 |
| 5-10 | qwen2.5:14b | 2秒/步 | 正常 |
| 10-25 | qwen2.5:32b | 3秒/步 | 较慢 |

## 🆚 与命令行模式对比

| 特性 | 实时Web | 命令行 |
|-----|--------|--------|
| 立即看到 | ✅ | ❌ |
| 保存数据 | ❌ | ✅ |
| 断点恢复 | ❌ | ✅ |
| 易用性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 适合观察 | ✅ | ❌ |
| 适合研究 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

## 💡 使用场景

### 适合实时模式

- ✅ 观察AI行为
- ✅ 调试角色互动
- ✅ 演示给别人看
- ✅ 快速测试新角色
- ✅ 学习AI决策过程

### 适合命令行模式

- ✅ 长时间运行（24小时+）
- ✅ 需要完整历史记录
- ✅ 批量实验
- ✅ 数据分析

## 📚 相关文档

详细文档：
- **`QUICK_START_REALTIME.md`** - 30秒快速启动
- **`REALTIME_SIMULATION_GUIDE.md`** - 完整使用指南
- **`REALTIME_SIMULATION_SUMMARY.md`** - 技术实现细节
- **`CHARACTER_GENERATOR_GUIDE.md`** - 角色创建指南

## 🎯 总结

### 启动三步走

```bash
# 1. 进入目录
cd /Users/sunyuefeng/GenerativeAgentsCN-1/generative_agents

# 2. 启动
python web_server.py

# 3. 打开
http://127.0.0.1:5000
```

### 立即看到

- 🎭 角色实时移动
- 💬 真实AI对话
- 🏃 自主活动
- 🌆 小镇生活

### 不需要

- ❌ 等待模拟完成
- ❌ 压缩数据
- ❌ 启动回放服务

---

**实现日期**: 2025年11月9日  
**状态**: ✅ 完成并测试  
**维护**: 保持前端界面不变，只改进后端逻辑  

🎉 **现在就试试吧！**












