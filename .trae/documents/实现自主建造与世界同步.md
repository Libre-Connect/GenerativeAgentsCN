## èƒŒæ™¯è¯Šæ–­
- å·²æœ‰â€œåœ°å½¢å¼€æ‹“å»ºé€ ç³»ç»Ÿâ€å®Œæˆé€‰å€ã€å»ºé€ ä¸ç”Ÿäº§ï¼ˆgenerative_agents/modules/terrain/terrain_development.py:201-213, 454-492ï¼‰
- å·²æœ‰â€œAIå»ºé€ å†³ç­–å¼•æ“â€å¯ä¸º Agent ç”Ÿæˆå»ºé€ å†³ç­–å¹¶æ‰§è¡Œï¼ˆgenerative_agents/modules/decision/ai_building_decision.py:97-158, 262-322ï¼‰
- æ¸¸æˆä¸»å¾ªç¯å·²è°ƒåº¦å»ºé€ ä¸ç»æµå†³ç­–ï¼ˆgenerative_agents/modules/game.py:200-218ï¼‰
- ç¼ºå¤±â€œåœ°å›¾å¯è§†å±‚åŒæ­¥â€ï¼šå»ºé€ åªå†™å…¥ TerrainDevelopmentEngine çš„å†…éƒ¨ç½‘æ ¼ï¼ŒæœªæŠŠå»ºç­‘ä½“æ ‡æ³¨åˆ°åœ°å›¾ä¸å‰ç«¯ APIï¼ˆgenerative_agents/modules/infinite_maze.pyã€generative_agents/modules/infinite_maze_api.pyï¼‰ï¼Œå› æ­¤ç”¨æˆ·çœ‹ä¸åˆ°â€œè‡ªä¸»æ„å»ºä¸–ç•Œâ€çš„ç»“æœ
- åæ ‡ä½“ç³»å‰²è£‚ï¼šTerrain ç½‘æ ¼ä½¿ç”¨(0..width, 0..height)ï¼›æ— é™åœ°å›¾ä½¿ç”¨ä¸–ç•Œåæ ‡(æ— é™æ•´æ•°)ã€‚æœªå»ºç«‹åŒå‘æ˜ å°„ï¼Œå¯¼è‡´å»ºé€ ä½ç½®ä¸æ˜¾ç¤ºä½ç½®ä¸ä¸€è‡´

## ç›®æ ‡
- å°†å»ºé€ äº‹ä»¶åœ¨åœ°å›¾å±‚è½åœ°å¹¶å¯è§†åŒ–ï¼šç“¦ç‰‡ç±»å‹/äº‹ä»¶æ›´æ–°ï¼Œå‰ç«¯å¯æŸ¥è¯¢åˆ°å»ºç­‘ä½“
- ç»Ÿä¸€åæ ‡æ˜ å°„ä¸å°±è¿‘é€‰å€ï¼šä¼˜å…ˆåœ¨ Agent é™„è¿‘é€‰å€ï¼Œç¡®ä¿â€œæ‰€è§å³æ‰€å¾—â€
- ä¿æŒç»æµä¸èµ„æºä¸€è‡´æ€§ï¼šAgent/å…¨å±€èµ„æºæ‰£å‡ä¸å»ºç­‘è¿›åº¦ä¸€è‡´

## å˜æ›´èŒƒå›´
- gameï¼šå¢åŠ â€œå»ºé€ â†’åœ°å›¾â€åŒæ­¥é’©å­ä¸åæ ‡è½¬æ¢ï¼ˆgenerative_agents/modules/game.pyï¼‰
- infinite_mazeï¼šæ–°å¢å»ºç­‘è½åœ° APIï¼ˆå¦‚ place_building / mark_constructionï¼‰ï¼Œæ›´æ–°ç“¦ç‰‡ç±»å‹ä¸äº‹ä»¶ï¼ˆgenerative_agents/modules/infinite_maze.pyï¼‰
- ai_building_decisionï¼šæ”¯æŒâ€œå°±è¿‘ä¼˜å…ˆâ€é€‰å€ï¼ˆæ–°å¢å¯é€‰å‚æ•°ï¼‰ï¼Œå…¼å®¹å½“å‰å†³ç­–ï¼ˆgenerative_agents/modules/decision/ai_building_decision.pyï¼‰
- infinite_maze_apiï¼šå‰ç«¯å¯è§åŒºåŸŸè¿”å›å»ºç­‘äº‹ä»¶ï¼Œæ— éœ€æ”¹åŠ¨ç»“æ„åªéœ€ç¡®ä¿äº‹ä»¶å†™å…¥ï¼ˆgenerative_agents/modules/infinite_maze_api.pyï¼‰

## å®æ–½æ­¥éª¤
1) åæ ‡æ˜ å°„
- åœ¨ game ä¸­å®ç° terrainâ†”world æ˜ å°„æ–¹æ³•ï¼š`terrain_to_world(x,y)` ä¸ `world_to_terrain(x,y)`ï¼Œä»¥å‡ºç”ŸåŒºä¸ºå‚è€ƒåŸç‚¹ï¼Œ1:1 æ˜ å°„æˆ–æŒ‰ `tile_size` ç¼©æ”¾
- å°† Agent çš„ä¸–ç•Œåæ ‡æ¢ç®—ä¸º Terrain ç½‘æ ¼åæ ‡ï¼Œç”¨äºâ€œå°±è¿‘é€‰å€â€

2) å°±è¿‘é€‰å€å¢å¼º
- ä¸º `AIBuildingDecisionEngine.analyze_agent_building_intention(...)` å¢åŠ å¯é€‰å‚æ•° `prefer_near=(tx, ty)`ï¼Œåœ¨ `find_optimal_development_sites` ç»“æœä¸ŠåŠ å…¥è·ç¦»æƒ©ç½š/åŠ æƒï¼Œä¼˜å…ˆè¿”å›ç¦» Agent æœ€è¿‘çš„é«˜åˆ†ç‚¹ï¼ˆgenerative_agents/modules/decision/ai_building_decision.py:127-133ï¼‰

3) å»ºé€ â†’åœ°å›¾å¯è§†åŒ–è½åœ°
- åœ¨ game çš„ `_process_agent_building_decision` ä¸­ï¼ŒæˆåŠŸå»ºé€ åï¼š
  - é€šè¿‡æ˜ å°„æ‹¿åˆ°ä¸–ç•Œåæ ‡ `(wx, wy)`
  - è°ƒç”¨ `maze.place_building(wx, wy, building_info)`ï¼š
    - è®¾ç½® `tile.tile_type` ä¸º `town/urban` æˆ–æŒ‰å»ºç­‘ç±»å‹å˜ä½“
    - åœ¨è¯¥ç“¦ç‰‡æ·»åŠ äº‹ä»¶ `subject=building_id`ï¼Œ`emoji` ç”¨å»ºç­‘ç±»å‹å›¾æ ‡ï¼ˆğŸ , ğŸŒ¾, â›ï¸, ğŸ­, ğŸ›£ï¸ ç­‰ï¼‰
    - å°†å»ºç­‘ç™»è®°åˆ° `maze.buildings[(wx,wy)]`
- å¯¹â€œåœ¨å»ºâ€çŠ¶æ€ä½¿ç”¨æ–½å·¥äº‹ä»¶ä¸ä¸´æ—¶å›¾æ ‡ï¼ˆå¦‚ ğŸš§ï¼‰ï¼Œå®Œå·¥åæ›¿æ¢ä¸ºæœ€ç»ˆå›¾æ ‡ï¼ˆgenerative_agents/modules/terrain/terrain_development.py:513-534ï¼‰

4) èµ„æºä¸€è‡´æ€§
- ä¿æŒç°æœ‰é€»è¾‘ï¼š
  - Agent ä¾§é€šè¿‡ `execute_building_decision` æ‰£å‡åº“å­˜ï¼ˆgenerative_agents/modules/agent.py:970-991ï¼‰
  - åœ°å½¢å¼•æ“æ‰£å‡å…¨å±€èµ„æºï¼ˆgenerative_agents/modules/terrain/terrain_development.py:501-506ï¼‰
- åœ¨åœ°å›¾äº‹ä»¶ä¸­æºå¸¦æˆæœ¬æ‘˜è¦ï¼Œä¾¿äºå‰ç«¯/æ—¥å¿—æ ¡éªŒ

5) æ¯æ—¥è¿è¥ä¸åœ°å›¾åˆ·æ–°
- åœ¨ `terrain_engine.simulate_daily_operations()` å®Œæˆåï¼ˆgenerative_agents/modules/terrain/terrain_development.py:619-642ï¼‰ï¼Œgame è°ƒç”¨ä¸€æ¬¡â€œå»ºç­‘è¿›åº¦â†’åœ°å›¾äº‹ä»¶åˆ·æ–°â€ï¼Œå°†æ–½å·¥è¿›åº¦å¯¹åº”å›¾æ ‡æ›´æ–°

## éªŒè¯
- æ—¥å¿—ï¼šåœ¨å»ºâ†’å®Œå·¥æ—¥å¿—ä¸äº‹ä»¶å†™å…¥
- åœ°å›¾ APIï¼šè°ƒç”¨ `/api/infinite_map/visible` åœ¨ Agent å‘¨è¾¹åº”å‡ºç°å¯¹åº”å»ºç­‘äº‹ä»¶ä¸ç“¦ç‰‡ç±»å‹å˜åŒ–ï¼ˆgenerative_agents/modules/infinite_maze_api.py:10-50ï¼‰
- ç»æµä¸€è‡´æ€§ï¼šæ£€æŸ¥ `economy.get_state()` ä¸­å„ Agent ä½™é¢/åº“å­˜ä¸ terrain å…¨å±€èµ„æºï¼ˆgenerative_agents/modules/economy/economy.py:329-344ï¼‰

## é£é™©ä¸å…¼å®¹æ€§
- åæ ‡æ˜ å°„é€‰æ‹©éœ€ç®€å•ä¸”ç¨³å®šï¼›é»˜è®¤ 1:1ï¼Œåç»­å†æŒ‰ `tile_size` ä¼˜åŒ–
- äº‹ä»¶é‡å¢åŠ å¯èƒ½å½±å“å‰ç«¯æ¸²æŸ“ï¼›é™åˆ¶æ¯ç“¦ç‰‡äº‹ä»¶æ•°å¹¶åšç¼“å­˜æ·˜æ±°
- ä¿æŒ API å‘åå…¼å®¹ï¼Œä¸æ”¹å˜ç°æœ‰å“åº”ç»“æ„

## æ—¶é—´é¢„ä¼°
- åæ ‡ä¸å°±è¿‘é€‰å€ï¼š~2h
- åœ°å›¾è½åœ°ä¸äº‹ä»¶ï¼š~3h
- åˆ·æ–°ä¸éªŒè¯ï¼š~1h
- æ€»è®¡ï¼š~6h