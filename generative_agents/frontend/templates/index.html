{% extends "base.html" %}

{% block content %}
<!-- 实时模拟控制面板 -->
<div class="row" style="margin-bottom: 20px; padding: 0 2em;">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <span class="glyphicon glyphicon-play-circle"></span> 实时小镇模拟控制
                </h4>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-success" id="startSimBtn">
                                <span class="glyphicon glyphicon-play"></span> 开始模拟
                            </button>
                            <button type="button" class="btn btn-warning" id="pauseSimBtn" disabled>
                                <span class="glyphicon glyphicon-pause"></span> 暂停
                            </button>
                            <button type="button" class="btn btn-danger" id="stopSimBtn" disabled>
                                <span class="glyphicon glyphicon-stop"></span> 停止
                            </button>
                        </div>
                        <div class="form-group" style="display: inline-block; margin-left: 20px;">
                            <label for="strideInput" style="margin-right: 10px;">时间步长(分钟):</label>
                            <input type="number" id="strideInput" class="form-control" value="10" min="1" max="60" style="width: 80px; display: inline-block;">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-right">
                            <div id="simulationStatus" class="alert alert-info" style="margin: 0; padding: 8px;">
                                <strong>状态:</strong> <span id="statusText">未启动</span><br>
                                <strong>步数:</strong> <span id="stepCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 10px;">
                    <div class="col-md-12">
                        <div id="connectionStatus" class="alert alert-warning" style="margin: 0; padding: 8px; display: none;">
                            <span class="glyphicon glyphicon-exclamation-sign"></span> 
                            <span id="connectionText">正在连接到服务器...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="game-container" style="text-align: center"></div>
<div>
    <div class="row">
        <div class="col-md-12" style="padding: 1em; padding-left:2em; padding-right:2em;">
            <div class="row" style="display: flex; flex-wrap: wrap; margin: -0.5em;">
                {% for p in persona_names %}
                <div style="text-align: center; margin: 0.5em;">
                    <div style="padding: 0;">
                        {% set image_static = 'assets/village/agents/' ~ p ~ '/portrait.png' %}
                        <img src="{{ url_for('static', filename=image_static) }}" style="width: 32px; padding: 0;">
                        <br>
                        {{ p }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block js_content %}
<script src='https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
{% include 'main_script.html' %}

{% endblock js_content %}
